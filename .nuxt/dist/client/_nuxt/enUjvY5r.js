import{_ as R}from"./B9MyqgL5.js";import{_ as U}from"./DdGVgslC.js";import{z as N,_ as x,r as d,o as r,c as l,b as m,w as g,h as u,u as V,f as $,n as y,m as P,i as I,a as c,s as f,A as G,d as F,t as T}from"./ClYIXCJx.js";import{H as B}from"./Btqz5vty.js";import{_ as C,M as D,a as O}from"./D79kEC_n.js";import{A as v}from"./4V2oDtkl.js";import{u as o}from"./D5VnKav6.js";import{_ as w}from"./lXXSD6iP.js";import{M as L}from"./dUX4x0Dj.js";import{u as j}from"./DRUVkWhE.js";import{_ as W}from"./evITL-mf.js";import{u as H}from"./Bj1xSGwV.js";import"./MQHk9dPr.js";import"./D3j8g8Cz.js";import"./CMS5Braa.js";import"./BX3o5zNH.js";import"./C4iS2aBk.js";const z={name:"MusicGainMeadow",components:{AudioElement:v},data(){return{audioContext:o().getContext(),createdNodes:{},musicReady:!1,meadow_src:window.location.origin+N().public.meadow_src,fading:!1,connected:!1,muted:!1}},beforeUnmount(){this.disconnectNodes()},methods:{disconnectNodes(){typeof this.createdNodes=="object"&&this.createdNodes!==null&&(Object.values(this.createdNodes).forEach(e=>{e&&(e.disconnect(),e=null)}),this.createdNodes=null)},toggleMute(){const t=this.$refs.Music.$refs.audioElement;t.muted=!t.muted,this.muted=t.muted},mute(){const t=this.$refs.Music.$refs.audioElement;t.muted=!0,this.muted=t.muted},unmute(){const t=this.$refs.Music.$refs.audioElement;t.muted=!1,this.muted=t.muted},refreshAudioContext(){const e=new AudioContext;this.audioContext.close(),o().audioContext=e,this.audioContext=o().getContext()},fadeInGains(){if(o().playing!==!0)return;const e=this.audioContext.currentTime+3;this.fading=!0,this.unmute();const t=this.createdNodes.musicGain;this.createdNodes.musicGain.gain.setValueAtTime(0,this.audioContext.currentTime),t.gain.linearRampToValueAtTime(1,e),setTimeout(()=>{this.fading=!1},e*1e3)},fadeOutGains(){if(this.createdNodes.musicGain){const e=this.createdNodes.musicGainValue.gain.value;this.createdNodes.musicGain.gain.linearRampToValueAtTime(e,this.audioContext.currentTime),this.createdNodes.musicGain.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+1.3)}},handleCanPlayMusic(){this.musicReady=!0,this.handlePlayingUpdate(!0)},readyForWebaudio(){return!!this.musicReady},handlePlayingUpdate2(e){if(!e){this.mute();return}this.readyForWebaudio()?e?this.handlePlayingUpdate(e):this.fadeOutGains():this.readyForWebaudio()&&this.handlePlayingUpdate(e)},handlePlayingUpdate(e){if(e){const a=this.$refs.Music.$refs.audioElement,s=this.audioContext,i=this.audioContext.destination;this.createdNodes.musicGain||=s.createGain(),this.createdNodes.musicGain.gain.setValueAtTime(0,s.currentTime),a.currentSrc!==this.meadow_src&&(this.createdNodes.musicSource.disconnect(),this.createdNodes.musicSource=s.createMediaElementSource(a),this.createdNodes.musicSource.connect(this.createdNodes.musicGain),this.createdNodes.musicGain.connect(i)),this.createdNodes.musicSource||=s.createMediaElementSource(a),this.createdNodes.musicSource.connect(this.createdNodes.musicGain),this.createdNodes.musicGain.connect(i),this.createdNodes.musicGain.gain.cancelScheduledValues(this.audioContext.currentTime),this.createdNodes.musicGain.gain.setValueAtTime(0,this.audioContext.currentTime),this.connected=!0,this.fadeInGains(),o().playing=!0}else this.fadeOutGains(),this.createdNodes=[],this.refreshAudioContext(),this.connected=!1},updateMusicGain(e){this.createdNodes.musicGain&&this.createdNodes.musicGain.gain.linearRampToValueAtTime(e,this.createdNodes.musicGain.context.currentTime+.3)}}},q={class:"player"};function J(e,t,a,s,i,n){const h=d("AudioElement");return r(),l("div",q,[m(h,{ref:"Music",key:"1",src:i.meadow_src,title:"Meadow","onUpdate:volume":n.updateMusicGain,"onUpdate:playing":n.handlePlayingUpdate2,"onUpdate:canplay":n.handleCanPlayMusic},{default:g(({})=>[i.muted?u("",!0):(r(),l("img",{key:0,style:{width:"25px"},src:w,title:"Click to mute",onClick:t[0]||(t[0]=p=>n.toggleMute())})),i.muted?(r(),l("img",{key:1,style:{width:"25px"},src:C,title:"Click to unmute",onClick:t[1]||(t[1]=p=>n.toggleMute())})):u("",!0)]),_:1},8,["src","onUpdate:volume","onUpdate:playing","onUpdate:canplay"])])}const K=x(z,[["render",J]]),Q={name:"MusicGainTropic",components:{AudioElement:v},data(){return{audioContext:o().getContext(),createdNodes:{},musicReady:!1,tropics_src:window.location.origin+N().public.tropics_src,fading:!1,connected:!1,muted:!1}},beforeUnmount(){this.disconnectNodes()},methods:{disconnectNodes(){typeof this.createdNodes=="object"&&this.createdNodes!==null&&Object.values(this.createdNodes).forEach(e=>{e&&(e.disconnect(),e=null)}),this.createdNodes=null},toggleMute(){const t=this.$refs.Music.$refs.audioElement;t.muted=!t.muted,this.muted=t.muted},mute(){const t=this.$refs.Music.$refs.audioElement;t.muted=!0,this.muted=t.muted},unmute(){const t=this.$refs.Music.$refs.audioElement;t.muted=!1,this.muted=t.muted},refreshAudioContext(){const e=new AudioContext;this.audioContext.close(),o().audioContext=e,this.audioContext=o().getContext()},fadeInGains(){if(o().playing!==!0)return;const e=this.audioContext.currentTime+3;this.fading=!0,this.unmute();const t=this.createdNodes.musicGain;this.createdNodes.musicGain.gain.setValueAtTime(0,this.audioContext.currentTime),t.gain.linearRampToValueAtTime(1,e),setTimeout(()=>{this.fading=!1},e*1e3)},fadeOutGains(){if(this.createdNodes.musicGain){const e=this.createdNodes.musicGainValue.gain.value;this.createdNodes.musicGain.gain.linearRampToValueAtTime(e,this.audioContext.currentTime),this.createdNodes.musicGain.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+1.3)}},handleCanPlayMusic(){this.musicReady=!0,this.handlePlayingUpdate(!0)},readyForWebaudio(){return!!this.musicReady},handlePlayingUpdate2(e){if(!e){this.mute();return}this.readyForWebaudio()?e?this.handlePlayingUpdate(e):this.fadeOutGains():this.readyForWebaudio()&&this.handlePlayingUpdate(e)},handlePlayingUpdate(e){if(e){const a=this.$refs.Music.$refs.audioElement,s=this.audioContext,i=this.audioContext.destination;this.createdNodes.musicGain||=s.createGain(),this.createdNodes.musicGain.gain.setValueAtTime(0,s.currentTime),a.currentSrc!==this.tropics_src&&(this.createdNodes.musicSource.disconnect(),this.createdNodes.musicSource=s.createMediaElementSource(a),this.createdNodes.musicSource.connect(this.createdNodes.musicGain),this.createdNodes.musicGain.connect(i)),this.createdNodes.musicSource||=s.createMediaElementSource(a),this.createdNodes.musicSource.connect(this.createdNodes.musicGain),this.createdNodes.musicGain.connect(i),this.createdNodes.musicGain.gain.cancelScheduledValues(this.audioContext.currentTime),this.createdNodes.musicGain.gain.setValueAtTime(0,this.audioContext.currentTime),this.connected=!0,this.fadeInGains(),o().playing=!0}else this.fadeOutGains(),this.createdNodes=[],this.refreshAudioContext(),this.connected=!1},updateMusicGain(e){this.createdNodes.musicGain&&this.createdNodes.musicGain.gain.linearRampToValueAtTime(e,this.createdNodes.musicGain.context.currentTime+.3)}}},X={class:"player"};function Y(e,t,a,s,i,n){const h=d("AudioElement");return r(),l("div",X,[m(h,{ref:"Music",key:"1",src:i.tropics_src,title:"Tropic","onUpdate:volume":n.updateMusicGain,"onUpdate:playing":n.handlePlayingUpdate2,"onUpdate:canplay":n.handleCanPlayMusic},{default:g(({})=>[i.muted?u("",!0):(r(),l("img",{key:0,style:{width:"25px"},src:w,title:"Click to mute",onClick:t[0]||(t[0]=p=>n.toggleMute())})),i.muted?(r(),l("img",{key:1,style:{width:"25px"},src:C,title:"Click to unmute",onClick:t[1]||(t[1]=p=>n.toggleMute())})):u("",!0)]),_:1},8,["src","onUpdate:volume","onUpdate:playing","onUpdate:canplay"])])}const Z=x(Q,[["render",Y]]),ee={name:"RNBODevice",components:{AudioElement:v,Microphone:L},data(){return{audioContext:o().getContext(),createdNodes:{},noiseReady:!1,micReady:!1,deviceReady:!1,noise_src:window.location.origin+N().public.noise_src,fading:!1,connected:!1,muted:!1}},methods:{toggleMute(){const t=this.$refs.Noise.$refs.audioElement;t.muted=!t.muted,this.muted=t.muted},mute(){const t=this.$refs.Noise.$refs.audioElement;t.muted=!0,this.muted=!0},unmute(){const t=this.$refs.Noise.$refs.audioElement;t.muted=!1,this.muted=!1},setupMicrophone(e){try{this.createdNodes.microphone||=this.audioContext.createMediaStreamSource(e),this.micReady=!0}catch(t){throw this.micReady=!1,new Error(t.message)}},async setupDevice(){try{const e=j();await e.create3BandDevice("adaptive_masking_controller_NoMusic"),this.createdNodes.noiseDevice=e.getDeviceAudioNode("adaptive_masking_controller_NoMusic"),this.deviceReady=!0}catch{this.deviceReady=!1}},refreshAudioContext(){const e=new AudioContext;this.audioContext.close(),o().audioContext=e,this.audioContext=o().getContext()},fadeInGains(){if(this.unmute(),o().playing!==!0)return;const e=this.audioContext.currentTime+3;setTimeout(()=>{this.fading=!0,this.createdNodes.noiseGain.gain.linearRampToValueAtTime(1,e)},450),setTimeout(()=>{this.fading=!1},e*1e3)},fadeOutGains(){if(this.createdNodes.noiseGain){const e=this.createdNodes.noiseGain.gain.value;this.createdNodes.noiseGain.gain.linearRampToValueAtTime(e,this.audioContext.currentTime),this.createdNodes.noiseGain.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+1.3)}},handleCanPlayNoise(e){this.noiseReady=e},readyForWebaudio(){return!(!this.noiseReady||!this.micReady||!this.deviceReady)},async handlePlayingUpdate2(e){if(!e){this.mute();return}this.readyForWebaudio()?this.handlePlayingUpdate(e):(this.deviceReady||await this.setupDevice(),this.micReady,this.readyForWebaudio()&&this.handlePlayingUpdate(e))},handlePlayingUpdate(e){if(e){const a=this.$refs.Noise.$refs.audioElement,s=this.audioContext,i=this.audioContext.destination;this.createdNodes.noiseGain||=s.createGain(),this.createdNodes.noiseGain.gain.setValueAtTime(0,s.currentTime),this.createdNodes.noiseSource||=s.createMediaElementSource(a),this.createdNodes.micSplitter||=s.createChannelSplitter(2),this.createdNodes.noiseInputChannelSplitter||=s.createChannelSplitter(2),this.createdNodes.microphone.connect(this.createdNodes.micSplitter),this.createdNodes.noiseSource.connect(this.createdNodes.noiseInputChannelSplitter),this.createdNodes.micSplitter.connect(this.createdNodes.noiseDevice,0,0),this.createdNodes.noiseInputChannelSplitter.connect(this.createdNodes.noiseDevice,0,1),this.createdNodes.noiseInputChannelSplitter.connect(this.createdNodes.noiseDevice,1,2),this.createdNodes.noiseDevice.connect(this.createdNodes.noiseGain),this.createdNodes.noiseGain.connect(i),this.createdNodes.noiseGain.gain.cancelScheduledValues(this.audioContext.currentTime),this.createdNodes.noiseGain.gain.setValueAtTime(0,this.audioContext.currentTime),a.muted=!1,this.connected=!0,this.fadeInGains(),o().playing=!0}else this.fadeOutGains(),this.createdNodes=[],this.refreshAudioContext(),this.connected=!1},updateNoiseGain(e){this.createdNodes.noiseGain&&this.createdNodes.noiseGain.gain.linearRampToValueAtTime(e,this.createdNodes.noiseGain.context.currentTime+.3)}}},te="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20width='85px'%20height='85px'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='%23000000'%20version='1.1'%20id='svg1'%20sodipodi:docname='noiseicon_muted.svg'%20inkscape:version='1.3.2%20(091e20e,%202023-11-25)'%20xmlns:inkscape='http://www.inkscape.org/namespaces/inkscape'%20xmlns:sodipodi='http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:svg='http://www.w3.org/2000/svg'%3e%3cdefs%20id='defs1'%20/%3e%3csodipodi:namedview%20id='namedview1'%20pagecolor='%23ffffff'%20bordercolor='%23111111'%20borderopacity='1'%20inkscape:showpageshadow='0'%20inkscape:pageopacity='0'%20inkscape:pagecheckerboard='1'%20inkscape:deskcolor='%23d1d1d1'%20inkscape:zoom='2.7764706'%20inkscape:cx='42.319915'%20inkscape:cy='42.5'%20inkscape:window-width='1200'%20inkscape:window-height='449'%20inkscape:window-x='3438'%20inkscape:window-y='188'%20inkscape:window-maximized='0'%20inkscape:current-layer='SVGRepo_iconCarrier'%20/%3e%3cg%20id='SVGRepo_bgCarrier'%20stroke-width='0'%20/%3e%3cg%20id='SVGRepo_tracerCarrier'%20stroke-linecap='round'%20stroke-linejoin='round'%20/%3e%3cg%20id='SVGRepo_iconCarrier'%3e%3cpath%20d='m%203,11%20v%202%20m%203,-3%20v%204%20m%203,-3%20v%202%20m%203,-4%20v%206%20m%203,3%20V%206%20m%203,4%20v%204%20m%203,-3%20v%202'%20stroke='%23000000'%20stroke-width='0.912'%20stroke-linecap='round'%20stroke-linejoin='round'%20id='path1'%20sodipodi:nodetypes='cccccccccccccc'%20/%3e%3cpath%20d='m%203,11%20v%202%20m%203,-3%20v%204%20m%203,-3%20v%202%20m%203,-4%20v%206%20M%203,18.40678%2022.322034,5.8983051%20M%2018,10%20v%204%20m%203,-3%20v%202'%20stroke='%23000000'%20stroke-width='0.912'%20stroke-linecap='round'%20stroke-linejoin='round'%20id='path2'%20sodipodi:nodetypes='cccccccccccccc'%20/%3e%3c/g%3e%3c/svg%3e",ie={class:"player"};function se(e,t,a,s,i,n){const h=d("Microphone"),p=d("AudioElement");return r(),l("div",ie,[m(h,{ref:"Microphone","onUpdate:attach":n.setupMicrophone},null,8,["onUpdate:attach"]),m(p,{ref:"Noise",key:"5",src:i.noise_src,title:"Noise","onUpdate:volume":n.updateNoiseGain,"onUpdate:canplay":n.handleCanPlayNoise,"onUpdate:playing":n.handlePlayingUpdate2},{default:g(({})=>[i.muted?u("",!0):(r(),l("img",{key:0,style:{width:"25px"},src:W,title:"Click to mute",onClick:t[0]||(t[0]=_=>n.toggleMute())})),i.muted?(r(),l("img",{key:1,style:{width:"25px"},src:te,title:"Click to unmute",onClick:t[1]||(t[1]=_=>n.toggleMute())})):u("",!0)]),_:1},8,["src","onUpdate:volume","onUpdate:canplay","onUpdate:playing"])])}const ne=x(ee,[["render",se]]),oe={components:{HomeBar:B,RNBODevice:ne,MusicGainLagoon:D,MusicGainMeadow:K,MusicGainTropic:Z,MusicGainForest:O},setup(){const{t:e}=V(),t=$(),a=y(null),s=y(null),i=y(null),n=y(null);return{t:e,localePath:t,Tropics:a,Lagoon:s,Meadow:i,Forest:n}},data(){return{bar_width:0,analyser:null,dataArray:null,bar_val:25,currentIndex:0,currentTitle:"Lagoon",currentRef:null}},computed:{...P(o,["audioContext"]),title(){const e=this.currentTitle;return this.$t(e)}},mounted(){this.addMediaNavigationHandling()},attachMicrophoneAnalyser(e){if(!(e instanceof AudioNode))throw new TypeError("Microphone cannot be used, please reload");{this.analyser=e.context.createAnalyser(),e.connect(this.analyser),this.analyser.fftSize=2048;const t=this.analyser.frequencyBinCount;this.dataArray=new Uint8Array(t),this.updateMeter()}},beforeUnmount(){try{H().detachMicrophoneSource(),o().pauseContext()}catch{}},methods:{...I(o,["getAudioContext"]),setTitleByIndex(e){switch(e){case 0:this.currentTitle="Lagoon",this.currentRef=this.$refs.Lagoon;break;case 1:this.currentTitle="Tropics",this.currentRef=this.$refs.Tropics;break;case 2:this.currentTitle="Forest",this.currentRef=this.$refs.Forest;break;case 3:this.currentTitle="Meadow",this.currentRef=this.$refs.Meadow;break}},changeSoundscape(e){let t=0;e==="x"&&(t=1,this.currentTitle="Tropics",this.currentRef=this.$refs.Tropics),e==="Lagoon"&&(t=0,this.currentTitle="Lagoon",this.currentRef=this.$refs.Lagoon),e==="Forest"&&(t=2,this.currentTitle="Forest",this.currentRef=this.$refs.Forest),e==="Meadow"&&(t=3,this.currentTitle="Meadow",this.currentRef=this.$refs.Meadow),this.currentIndex=t,this.$nextTick().then(()=>{this.unmuteActive()})},unmuteActive(){o().setPlaying(!1),setTimeout(()=>{o().setPlaying(!0)},50)},handleAnimation:function(e){this.anim=e},addMediaNavigationHandling(){"mediaSession"in navigator&&(navigator.mediaSession.setActionHandler("play",e=>{o().setPlaying(!0)}),navigator.mediaSession.setActionHandler("pause",e=>{o().setPlaying(!1)}),navigator.mediaSession.setActionHandler("nexttrack",e=>{this.currentIndex<3?this.currentIndex++:this.currentIndex=0,this.$nextTick().then(()=>{this.setTitleByIndex(this.currentIndex),this.unmuteActive()})}),navigator.mediaSession.setActionHandler("previoustrack",e=>{this.currentIndex<1?this.currentIndex=3:this.currentIndex--,this.$nextTick().then(()=>{this.setTitleByIndex(this.currentIndex),this.unmuteActive()})}))},updateMeter(){requestAnimationFrame(this.updateMeter),this.analyser.getByteFrequencyData(this.dataArray);const e=this.getRMS(this.dataArray);let t=20*Math.log10(e/128);t=Math.max(0,Math.min(100,t+100)),this.bar_width=t},getRMS(e){let t=0;for(let a=0;a<e.length;a++)t+=e[a]*e[a];return t/=e.length,t=Math.sqrt(t),t}}},ae={class:"container-fluid"},ce={class:"row"},re={class:"col-12 px-0 mx-0"},de={class:"container-fluid"},ue={class:"row justify-content-center"},le={class:"adaptive pb-3"},me={class:"col-12"},he={class:"d-none d-md-block mx-auto pb-1",style:{width:"225px"}},pe={class:"progress",style:{height:"10px"}},fe={class:"d-flex justify-content-center mb-1"},ge={class:"",style:{color:"#e9c046"}},ye=c("span",{class:"ps-3"},[c("i",{style:{padding:"5px 0px"},class:"fa-solid text-muted d-flex fa-chevron-right"})],-1),xe={class:"d-block d-md-none mx-auto pb-1",style:{width:"225px"}},_e={class:"progress",style:{height:"10px"}};function Ne(e,t,a,s,i,n){const h=d("home-bar"),p=d("MusicGainLagoon"),_=d("MusicGainTropic"),M=d("MusicGainForest"),k=d("MusicGainMeadow"),A=d("RNBODevice"),b=R,S=U,E=d("video-background");return r(),l("div",null,[c("div",ae,[c("div",ce,[c("div",re,[m(E,{poster:"/images/posters/poster1.png",src:"/video/Lagoon.mp4",style:{height:"100vh"},preload:"auto"},{default:g(()=>[m(h,{title:s.t(i.currentTitle),"onUpdate:soundscape":n.changeSoundscape},null,8,["title","onUpdate:soundscape"]),c("div",de,[c("div",ue,[c("div",le,[i.currentIndex==2?(r(),f(p,{key:0,ref:"Lagoon"},null,512)):u("",!0),i.currentIndex==1?(r(),f(_,{key:1,ref:"Tropics"},null,512)):u("",!0),i.currentIndex==0?(r(),f(M,{key:2,ref:"Forest"},null,512)):u("",!0),i.currentIndex==3?(r(),f(k,{key:3,ref:"Meadow"},null,512)):u("",!0),(r(),f(A,{key:4})),c("div",me,[c("div",he,[c("div",pe,[c("div",{class:"progress-bar bar",role:"progressbar","aria-label":"Basic example",style:G([{width:i.bar_width+"%"},{"background-color":"#e9c046",transition:"0.1s"}]),"aria-valuenow":"75","aria-valuemin":"0","aria-valuemax":"100"},null,4)])]),c("div",fe,[m(b,{to:"#adaptive-modal","data-bs-target":"#adaptive-modal","data-bs-toggle":"modal",class:"text-muted text-decoration-none fw-bold fs-6"},{default:g(()=>[F(T(s.t("Adaptive soundscape"))+": ",1),c("span",ge,T(s.t("On")),1)]),_:1}),ye]),c("div",xe,[c("div",_e,[c("div",{class:"progress-bar bar",role:"progressbar","aria-label":"Basic example",style:G([{width:i.bar_width+"%"},{"background-color":"#e9c046",transition:"0.1s"}]),"aria-valuenow":"75","aria-valuemin":"0","aria-valuemax":"100"},null,4)])])]),m(S)])])])]),_:1})])])])])}const Fe=x(oe,[["render",Ne]]);export{Fe as default};
